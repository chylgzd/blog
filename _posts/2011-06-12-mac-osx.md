---
layout: post
title: MacOS相关
category: [mac,osxfuse,ntfs-3g,Touch-ID,自启动,Parallels,VirtualBox,Anaconda,Tensorflow,Spleeter,人声,Automator,php]
comments: false
---

* content
{:toc}

### 在mac上读写NTFS移动硬盘或usb

```
原因：mac默认只可读NTFS文件系统不支持写入

1.下载FUSE for macOS(FUSE for macOS是提供了底层读写扩展的接口)
https://github.com/osxfuse/osxfuse/releases

2.安装ntfs-3g
> brew install ntfs-3g

3.自定义挂载的目录
> mkdir -p /Users/xxx/mnt

4.插入USB 或 移动硬盘使用diskutil查看磁盘IDENTIFIER(一般是external扩展盘且type为Windows_NTFS)
> diskutil list

5.umount该只读ntfs盘后使用ntfs-3g重新挂载到自定义目录即可读写ntfs系统了
> sudo umount /dev/disk2s1
> sudo /usr/local/bin/ntfs-3g /dev/disk2s1 /Users/xxx/mnt -olocal -oallow_other -o auto_xattr
> open /Users/xxx/mnt
```

### 用Touch ID在终端指纹解锁sudo密码

```
#给只读文件赋写权限
> sudo chmod +w /etc/pam.d/sudo

#第一行新增pam_tid.so
> sudo vim /etc/pam.d/sudo
# sudo: auth account password session
auth       sufficient     pam_tid.so

#重新恢复到只读
> sudo chmod -w /etc/pam.d/sudo

#新建终端窗口测试不用再输入密码会弹出指纹验证
> sudo ls -la

#新建命令切换到root
> vim ~/bin/root.sh
#!/bin/sh

currentpath="`pwd`"

echo $currentpath
#sudo -i
#sudo su
sudo -s -H

```

### 禁止第三方软件顽固自启动

```
一般自启动文件为*.plist文件且在LaunchAgents目录
> open ~/Library/LaunchAgents/
(注意：在该目录下打开相应文件时必须用Xcode.app打开)
修改或新增Root下属性(不存在则新增)：
Disabled Boolean YES
KeepAlive Boolean NO

```

### 自带词典默认设置与扩展

```
打开应用程序 - 词典.app - 偏好设置,默认勾选牛津英汉汉英词典(简体中文-英语)

如何扩展：
把下载的langdao-ce-gb.dictionary和langdao-ec-gb.dictionary英汉互译词典文件
拷贝到 ~/Library/Dictionaries 目录后再默认勾选中即可

```

### Parallels Desktop虚拟机相关

```
由于VirtualBox启动后很占资源，一般在mac下可以用Parallels打开已存在的vbox文件转换后，用Parallels启动
或者参考https://kb.parallels.com/en/124109如何直接在Parallels里安装linux，安全起见必须选择与mac隔离，
并且调整硬盘非自动扩展，固定分配20G即可

问题：虚拟机里mint(ubuntu)分辨率只能设置800x600的问题
解决：
> apt install xdiagnose
> sudo xdiagnose
弹出xdiagnose设置框，设置debug下三个选项全部勾选后关闭xdiagnose并重启系统
> xrandr 查询系统支持的所有分辨率

```

### mds_stores文件索引导致发热问题
```
关闭文件索引
> sudo mdutil -a -i off

若要开启则
> sudo mdutil -a -i on
```

### 标签失效问题
```
导致标签失效的可能原因：
1，mds_stores文件索引关闭了(这里如果快捷tag少的话可以直接拖到个人收藏，这样继可以关闭索引不发热也能不用tag达到快捷访问目的)
2，Spotlight聚焦设置里隐私项目添加的文件夹是失效tag的上级文件夹

```

### 利用spleeter分离伴奏与人声
```
1, 安装 Anaconda
> brew cask install anaconda
> vim  ~/.zshrc
export PATH="$PATH:/usr/local/anaconda3/bin"
> conda -V
conda 4.8.3

2, 配置cn源
> vim ~/.condarc
channel_priority: flexible
ssl_verify: true
channels:
  - conda-forge
  - defaults
show_channel_urls: true
channel_alias: https://mirrors.tuna.tsinghua.edu.cn/anaconda
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud

3, 安装 spleeter -> https://github.com/deezer/spleeter/wiki/1.-Installation#using-conda
> conda install -c conda-forge spleeter

4, 测试 
> spleeter separate -i test.mp3 -p spleeter:2stems -o /tmp

5, 测试如果成功可使用简易脚本模式
> vim tqrs.sh
#!/bin/sh
_wkdir_root="/data/test/music"
_wkdir_out="$_wkdir_root/out"
if [ $# -eq 1 ];then

echo "要分离人声的音乐文件路径为：$_wkdir_root/$1" 
if [ ! -f "$_wkdir_root/$1" ]; then
	echo "不存在该文件!"
    exit 0
fi

cd  $_wkdir_root
echo "分离人声中..."
spleeter separate -i $1 -p spleeter:2stems -o $_wkdir_out
echo "结束"
exit 0

else
echo "未输入 $_wkdir_root 目录下音乐文件名(如mydemo.mp3)"
fi

===================== 可能存在的错误及解决方案 =====================
=> Solving environment: failed
	原因：网络或其它
	解决：失败会自动切换再尝试，耐心等待即可(conda config --set channel_priority flexible)
	
=> AttributeError: module ‘tensorflow’ has no attribute ‘compat’
	原因：tensorflow-estimator 与 tensorflow 版本不匹配( 比如出现 tensorflow 1.15.0 而 tensorflow-estimator 2.0.0 的情况)
	解决：
		> pip list | grep  tensorflow
		> pip uninstall tensorflow-estimator
		> pip install tensorflow-estimator==1.15.0 -i https://pypi.tuna.tsinghua.edu.cn/simple

=> TensorFlow | ValueError: Can't load save_path when it is None
	原因：下载模型文件失败或未完成
	解决：删除当前目录下pretrained_models即可，慢的话可能需要开启代理重试一次
	
```

### Automator脚本

#### 翻译
```
新建文件(必须用Xcode才能编辑和保存)
~/Library/Services/translate.workflow

控件
网站弹出式菜单 -> 自定/720x480/居中/iphone/所选文本)

运行AppleScript(每次右上角运行按钮就相当于已保存)：
on run {input, parameters}
	#google -> https://translate.google.cn/?sl=en&tl=zh-CN&text=
	#bing -> https://cn.bing.com/translator?mkt=zh-CN&text=
	set output to "https://cn.bing.com/translator?mkt=zh-CN&text=" & urldecode(input as string)
	
	return output
	
end run

on urldecode(x)
	
	set cmd to "'require \"cgi\"; puts CGI.escape(STDIN.read.chomp)'"
	
	do shell script "echo " & quoted form of x & " | ruby -e " & cmd
	
end urldecode
```

### MAC 下 PHP 与 Apache2 环境

#### 启用php
```
Mac自带了Apache和PHP环境,但默认未开启

#查看apache版本
> apachectl -version

# 查看php版本
> php -v

# 开启Apache,在浏览器中输入localhost:80查看结果
> sudo apachectl start

# 关闭Apache
> sudo apachectl stop

# 重启Apache
> sudo apachectl restart

# 开启PHP
> sudo vim /etc/apache2/httpd.conf
查找#LoadModule php7_module libexec/apache2/libphp7.so去掉#注释即可
查找DocumentRoot找到对应默认web目录/Library/WebServer/Documents

# 测试php是否正常
> vim /Library/WebServer/Documents/index.php
<?php phpinfo(); ?>
在DocumentRoot默认web目录下新建index.php并删除index.html,
访问localhost是否打印php信息

# 查看错误日志与访问日志
> tail -f /var/log/apache2/error_log
> tail -f /var/log/apache2/access_log

# 查看php.ini文件位置
> php -i |grep php.ini

# 查看PHP是否支持某个模块插件
> php -m | grep redis
> php -m | grep mysql

# 修改Apache DocumentRoot默认web目录
> sudo vim /etc/apache2/httpd.conf
替换DocumentRoot和Directory目录为自定义目录重启Apache即可
若403 Forbidden,You don't have permission to access/on this server
则修改
#<Directory />
#   AllowOverride none
#  Require all denied
#</Directory>
为
<Directory />
    Options  Indexes  FollowSymLinks
    AllowOverride None
   Order deny,allow
    Allow from all
</Directory>

```

#### php-redis模块安装

```
是否存在,已存在则无需安装
> php -m | grep redis
源码克隆编译
> git clone https://github.com/phpredis/phpredis.git
> cd ./phpredis
> phpize
grep: /usr/include/php/main/php.h: No such file or directory
解决方案
10.14:
重新安装header头文件SDK即可
cd /Library/Developer/CommandLineTools/Packages/
$ open macOS_SDK_headers_for_macOS_10.14.pkg

10.15:
 xcode-select --install # 安装常用开发工具，如：git等。
 sudo mount -uw /	# 根目录挂载为可读写，否则无法在/usr/下建立文件，本修改重启前有效。
 sudo ln -s "$(xcrun --show-sdk-path)/usr/include" /usr/include
 export SDKROOT="$(xcrun --show-sdk-path)" # 设置环境变量
 echo "export SDKROOT=\"\$(xcrun --show-sdk-path)\"" >> ~/.bash_profile # zsh的自行搞定
 sudo DevToolsSecurity -enable # 将系统置于开发模式
 
> ./configure
> make
> make install

开启php redis扩展
> vim /etc/php.ini
添加extension=redis.so保存即可
> php -m | grep redis
```